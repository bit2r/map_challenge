[
  {
    "objectID": "approval_rate.html",
    "href": "approval_rate.html",
    "title": "지도제작 대회",
    "section": "",
    "text": "윤석열 대통령\n문재인 대통령\n박근혜 대통령\n이명박 대통령\n노무현 대통령\n\n\n\n\n코드library(tidyverse)\nlibrary(rvest)\nextrafont::loadfonts()\n\nyoon_url &lt;- 'https://namu.wiki/w/%EC%9C%A4%EC%84%9D%EC%97%B4/%EC%A7%80%EC%A7%80%EC%9C%A8'\n\nyoon_html &lt;- read_html(yoon_url)\n\nyoon_list &lt;- yoon_html |&gt; \n  html_nodes('table') |&gt; \n  html_table(header = TRUE)\n\nyoon_raw &lt;- yoon_list |&gt; \n  enframe() |&gt; \n  mutate(nrow = map_int(value, nrow)) |&gt; \n  filter(nrow &gt; 54) |&gt; \n  mutate(조사회사 = c(\"한국갤럽\", \"리얼미터\", \"전국지표조사\")) \n\nclean_tbl &lt;- function(dataframe) {\n  three_tbl &lt;- dataframe |&gt; \n    janitor::clean_names(ascii = FALSE) |&gt; \n    select(1:3) |&gt; \n    set_names(c(\"조사기간\", \"긍정\", \"부정\")) |&gt; \n    filter(str_detect(조사기간, \"^\\\\d{4}년\"))\n}\n\nyoon_tbl &lt;- yoon_raw |&gt; \n  mutate(data = map(value, clean_tbl)) |&gt; \n  select(조사회사, data) |&gt; \n  unnest(data) |&gt; \n  mutate(긍정 = parse_number(긍정),\n         부정 = parse_number(부정)) |&gt; \n  fill(긍정, .direction = \"down\") |&gt; \n  fill(부정, .direction = \"down\") |&gt; \n  pivot_longer(긍정:부정, names_to = \"긍부정\", values_to = \"지지율\") \n\nconvert_korean_date &lt;- function(korean_date) {\n  # Split the input into components\n  components &lt;- strsplit(korean_date, \" \")[[1]]\n  \n  # Extract year, month, and week\n  year &lt;- as.numeric(gsub(\"년\", \"\", components[1]))\n  month &lt;- as.numeric(gsub(\"월\", \"\", components[2]))\n  week &lt;- as.numeric(gsub(\"주\", \"\", components[3]))\n  \n  # Construct the date - the first day of the month and year, then add weeks\n  date &lt;- make_date(year, month, 1) + weeks(week - 1)\n  \n  return(date)\n}\n  \nyoon_gg_tbl &lt;- yoon_tbl |&gt; \n  mutate(조사기간 = map(조사기간, convert_korean_date)) |&gt; \n  unnest(조사기간) |&gt; \n  mutate(조사회사 = factor(조사회사, levels = c(\"한국갤럽\", \"리얼미터\", \"전국지표조사\"))) |&gt; \n  filter(조사회사 == \"한국갤럽\",\n         조사기간 &gt;= as.Date(\"2022-05-07\"))\n\nelection_interval &lt;- -interval(ymd(\"2024-04-10\"), ymd('2023-08-05'))\n\nelection_period   &lt;- as.period(election_interval, unit = \"month\") \n\nremaining_ymd &lt;- glue::glue(\"남은 기간:\\n {month(election_period)}월 {day(election_period)}일\")\n\nyoon_approval_gg &lt;- yoon_gg_tbl  |&gt; \n  ggplot(aes(x = 조사기간, y = 지지율, color= 긍부정)) +\n    geom_point(data = yoon_gg_tbl |&gt; filter(조사기간 == max(조사기간)), \n               aes(x = 조사기간, y = 지지율, color= 긍부정), size = 1.5) +\n    geom_hline(yintercept = 50, linetype = 2, color = \"gray50\") +\n    geom_vline(xintercept = as.Date(\"2024-04-10\"), linetype = 1, color = \"gray50\") +    \n    geom_line() +\n    scale_color_manual(values = c(\"긍정\" = \"blue\", \"부정\" = \"red\")) +\n    labs(x = \"\",\n         y = \"지지율(%)\",\n         title = \"윤석열 대통령 지지율 추세\") +\n    theme(legend.position = \"top\") +\n    expand_limits(x = c(as.Date(\"2022-05-10\"), as.Date(\"2027-05-09\"))) +\n    scale_x_date(date_labels =  \"%Y\", breaks = \"1 year\")  +\n    geom_text(aes(x=as.Date(\"2023-12-01\"), y = 60, label = remaining_ymd), \n              color = \"gray10\", size = 3, family = \"MaruBrui\") +\n    geom_text(aes(x=as.Date(\"2024-08-01\"), y = 65, label = \"제22대 총선\\n4월10일\"), \n              color = \"gray10\", size = 3, family = \"MaruBrui\")  \n\nyoon_approval_gg\n\nragg::agg_jpeg(\"images/대통령지지율/윤석열.jpeg\",\n              width = 10, height = 7, units = \"in\", res = 600)\nyoon_approval_gg\ndev.off()\n\n\n\n\n\n\n\n\n\n코드library(tidyverse)\nlibrary(rvest)\n\nmoon_url &lt;- 'https://namu.wiki/w/%EB%AC%B8%EC%9E%AC%EC%9D%B8/%EC%A7%80%EC%A7%80%EC%9C%A8'\n\nmoon_html &lt;- read_html(moon_url)\n\nmoon_list &lt;- moon_html |&gt; \n  html_nodes('table') |&gt; \n  html_table(header = TRUE)\n\nmoon_raw &lt;- moon_list |&gt; \n  enframe() |&gt; \n  mutate(nrow = map_int(value, nrow)) |&gt; \n  filter(nrow &gt; 30) |&gt; \n  mutate(id = row_number(),\n         조사회사 = ifelse(id &gt;6, \"리얼미터\", \"한국갤럽\")) \n\nclean_tbl &lt;- function(dataframe) {\n  three_tbl &lt;- dataframe |&gt; \n    janitor::clean_names(ascii = FALSE) |&gt; \n    select(1:3) |&gt; \n    set_names(c(\"조사기간\", \"긍정\", \"부정\")) |&gt; \n    filter(str_detect(조사기간, \"^\\\\d{4}년\"))\n}\n\nmoon_tbl &lt;- moon_raw |&gt; \n  mutate(data = map(value, clean_tbl)) |&gt; \n  filter(nrow &gt; 250) |&gt; \n  select(조사회사, data) |&gt; \n  unnest(data) |&gt; \n  mutate(긍정 = parse_number(긍정),\n         부정 = parse_number(부정)) |&gt; \n  fill(긍정, .direction = \"down\") |&gt; \n  fill(부정, .direction = \"down\") |&gt; \n  pivot_longer(긍정:부정, names_to = \"긍부정\", values_to = \"지지율\") \n\nconvert_korean_date &lt;- function(korean_date) {\n  # Split the input into components\n  components &lt;- strsplit(korean_date, \" \")[[1]]\n  \n  # Extract year, month, and week\n  year &lt;- as.numeric(gsub(\"년\", \"\", components[1]))\n  month &lt;- as.numeric(gsub(\"월\", \"\", components[2]))\n  week &lt;- as.numeric(gsub(\"주\", \"\", components[3]))\n  \n  # Construct the date - the first day of the month and year, then add weeks\n  date &lt;- make_date(year, month, 1) + weeks(week - 1)\n  \n  return(date)\n}\n  \nmoon_approval_gg &lt;- moon_tbl |&gt; \n  mutate(조사기간 = map(조사기간, convert_korean_date)) |&gt; \n  unnest(조사기간) |&gt; \n  mutate(조사회사 = factor(조사회사, levels = c(\"한국갤럽\", \"리얼미터\"))) |&gt; \n  filter(조사회사 == \"한국갤럽\") |&gt; \n  ggplot(aes(x = 조사기간, y = 지지율, color= 긍부정)) +\n    geom_hline(yintercept = 50, linetype = 2, color = \"gray50\") +  \n    geom_line() +\n    # facet_wrap(~조사회사) +\n    scale_color_manual(values = c(\"긍정\" = \"blue\", \"부정\" = \"red\")) +\n    labs(x = \"\",\n         y = \"지지율(%)\",\n         title = \"문재인 대통령 지지율 추세\") +\n    theme(legend.position = \"top\")\n\nmoon_approval_gg\n\nragg::agg_jpeg(\"images/대통령지지율/문재인.jpeg\",\n              width = 10, height = 7, units = \"in\", res = 600)\nmoon_approval_gg\ndev.off()\n\n\n\n\n\n\n\n\n\n코드\npark_url &lt;- 'https://namu.wiki/w/%EB%B0%95%EA%B7%BC%ED%98%9C/%EC%A7%80%EC%A7%80%EC%9C%A8'\n\npark_html &lt;- read_html(park_url)\n\npark_list &lt;- park_html |&gt; \n  html_nodes('table') |&gt; \n  html_table(header = TRUE)\n\npark_raw &lt;- park_list |&gt; \n  enframe() |&gt; \n  mutate(nrow = map_int(value, nrow)) |&gt; \n  filter(nrow &gt; 30) |&gt; \n  mutate(조사회사 = \"한국갤럽\") \n\n\npark_tbl &lt;- park_raw |&gt; \n  mutate(data = map(value, clean_tbl)) |&gt; \n  filter(nrow &gt; 200) |&gt; \n  select(조사회사, data) |&gt; \n  unnest(data) |&gt; \n  mutate(긍정 = parse_number(긍정),\n         부정 = parse_number(부정)) |&gt; \n  fill(긍정, .direction = \"down\") |&gt; \n  fill(부정, .direction = \"down\") |&gt; \n  pivot_longer(긍정:부정, names_to = \"긍부정\", values_to = \"지지율\") \n\npark_approval_gg &lt;- park_tbl |&gt; \n  mutate(조사기간 = map(조사기간, convert_korean_date)) |&gt; \n  unnest(조사기간) |&gt; \n  ggplot(aes(x = 조사기간, y = 지지율, color= 긍부정)) +\n    geom_hline(yintercept = 50, linetype = 2, color = \"gray50\") +  \n    geom_line() +\n    scale_color_manual(values = c(\"긍정\" = \"blue\", \"부정\" = \"red\")) +\n    labs(x = \"\",\n         y = \"지지율(%)\",\n         title = \"박근혜 대통령 지지율 추세\") +\n    theme(legend.position = \"top\")\n\npark_approval_gg\n\nragg::agg_jpeg(\"images/대통령지지율/박근혜.jpeg\",\n              width = 10, height = 7, units = \"in\", res = 600)\npark_approval_gg\ndev.off()\n\n\n\n\n\n\n\n\n\n코드\nlee_url &lt;- 'https://namu.wiki/w/%EC%9D%B4%EB%AA%85%EB%B0%95/%EC%A7%80%EC%A7%80%EC%9C%A8'\n\nlee_html &lt;- read_html(lee_url)\n\nlee_list &lt;- lee_html |&gt; \n  html_nodes('table') |&gt; \n  html_table(header = TRUE)\n\nlee_raw &lt;- lee_list |&gt; \n  enframe() |&gt; \n  mutate(nrow = map_int(value, nrow)) |&gt; \n  filter(nrow &gt; 30) |&gt; \n  mutate(조사회사 = \"한국갤럽\") \n\nconvert_ym_date &lt;- function(korean_date) {\n  \n  # Split the input into components\n  components &lt;- strsplit(korean_date, \" \")[[1]]\n  \n  # Extract year and month\n  year &lt;- as.numeric(gsub(\"년\", \"\", components[1]))\n  month &lt;- as.numeric(gsub(\"월\", \"\", components[2]))\n  \n  # Construct the date - the first day of the month and year\n  date &lt;- make_date(year, month, 15)\n  \n  return(date)\n}\n\nlee_tbl &lt;- lee_raw |&gt; \n  mutate(data = map(value, clean_tbl)) |&gt; \n  filter(nrow &gt; 90) |&gt; \n  select(조사회사, data) |&gt; \n  unnest(data) |&gt; \n  mutate(긍정 = parse_number(긍정),\n         부정 = parse_number(부정)) |&gt; \n  fill(긍정, .direction = \"down\") |&gt; \n  fill(부정, .direction = \"down\") |&gt; \n  separate(조사기간, into = c(\"시작\", \"끝\"), sep = \"-\") |&gt; \n  select(-끝) |&gt; \n  mutate(조사기간 = case_when(str_detect(시작, \"주$\") ~ map(시작, convert_korean_date), \n                              TRUE ~                    map(시작, convert_ym_date))) |&gt; \n  unnest(조사기간) |&gt; \n  mutate(조사기간 = as.Date(조사기간, origin = \"1970-01-01\"))\n\nprevious_date &lt;- ymd(\"2012-04-11\") - election_period\n\n\nlee_current_tbl &lt;- lee_tbl |&gt; \n  pivot_longer(긍정:부정, names_to = \"긍부정\", values_to = \"지지율\") |&gt; \n  filter(조사기간 == previous_date+9)\n\nlee_approval_gg &lt;- lee_tbl |&gt; \n  pivot_longer(긍정:부정, names_to = \"긍부정\", values_to = \"지지율\") |&gt;\n  ggplot(aes(x = 조사기간, y = 지지율, color= 긍부정)) +\n    geom_point(data = lee_current_tbl, aes(x = 조사기간, y = 지지율, color= 긍부정)) +\n    geom_text(data = lee_current_tbl, aes(x = 조사기간, y = 지지율, color= 긍부정,\n                                          label = 지지율), vjust = -1.5) +\n    geom_hline(yintercept = 50, linetype = 2, color = \"gray50\") +  \n    geom_line() +\n    scale_color_manual(values = c(\"긍정\" = \"blue\", \"부정\" = \"red\")) +\n    labs(x = \"\",\n         y = \"지지율(%)\",\n         title = \"이명박 대통령 지지율 추세\") +\n    theme(legend.position = \"top\") +\n    scale_x_date(date_labels =  \"%Y\", breaks = \"1 year\") +\n    geom_vline(xintercept = as.Date(\"2012-04-11\"), linetype = 1, color = \"gray50\") +\n    geom_text(aes(x=as.Date(\"2011-12-01\"), y = 45, label = remaining_ymd), \n              color = \"gray10\", size = 3, family = \"MaruBrui\") +\n    geom_text(aes(x=as.Date(\"2012-08-01\"), y = 65, label = \"제19대 총선\\n4월11일\"), \n              color = \"gray10\", size = 3, family = \"MaruBrui\")  \n  \nlee_approval_gg\n\nragg::agg_jpeg(\"images/대통령지지율/이명박.jpeg\",\n              width = 10, height = 7, units = \"in\", res = 600)\nlee_approval_gg\ndev.off()\n\n\n\n\n\n\n\n\n\n코드\nrho_url &lt;- 'https://namu.wiki/w/%ED%8B%80:%ED%95%9C%EA%B5%AD%EA%B0%A4%EB%9F%BD%20%EB%85%B8%EB%AC%B4%ED%98%84%20%EB%8C%80%ED%86%B5%EB%A0%B9%20%EA%B5%AD%EC%A0%95%EC%A7%80%EC%A7%80%EC%9C%A8'\n\nrho_html &lt;- read_html(rho_url)\n\nrho_list &lt;- rho_html |&gt; \n  html_nodes('table') |&gt; \n  html_table(header = TRUE)\n\nrho_raw &lt;- rho_list |&gt; \n  enframe() |&gt; \n  mutate(nrow = map_int(value, nrow)) |&gt; \n  filter(nrow &gt; 30) |&gt; \n  mutate(조사회사 = \"한국갤럽\") \n\n\nrho_tbl &lt;- rho_raw |&gt; \n  mutate(data = map(value, clean_tbl)) |&gt; \n  filter(nrow &gt; 20) |&gt; \n  select(조사회사, data) |&gt; \n  unnest(data) |&gt; \n  mutate(긍정 = parse_number(긍정),\n         부정 = parse_number(부정)) |&gt; \n  fill(긍정, .direction = \"down\") |&gt; \n  fill(부정, .direction = \"down\") |&gt; \n  separate(조사기간, into = c(\"시작\", \"끝\"), sep = \"-\") |&gt; \n  select(-끝) |&gt; \n  mutate(조사기간 = case_when(str_detect(시작, \"주$\") ~ map(시작, convert_korean_date), \n                              TRUE ~                    map(시작, convert_ym_date))) |&gt; \n  unnest(조사기간) |&gt; \n  mutate(조사기간 = as.Date(조사기간, origin = \"1970-01-01\"))\n  \n\nrho_approval_gg &lt;- rho_tbl |&gt; \n  pivot_longer(긍정:부정, names_to = \"긍부정\", values_to = \"지지율\") |&gt;\n  ggplot(aes(x = 조사기간, y = 지지율, color= 긍부정)) +\n    geom_hline(yintercept = 50, linetype = 2, color = \"gray50\") +  \n    geom_line() +\n    scale_color_manual(values = c(\"긍정\" = \"blue\", \"부정\" = \"red\")) +\n    labs(x = \"\",\n         y = \"지지율(%)\",\n         title = \"노무현 대통령 지지율 추세\") +\n    theme(legend.position = \"top\")\n\nrho_approval_gg\n\nragg::agg_jpeg(\"images/대통령지지율/노무현.jpeg\",\n              width = 10, height = 7, units = \"in\", res = 600)\nrho_approval_gg\ndev.off()\n\n\n\n\n\n\n\n코드rho_tbl |&gt; select(조사회사, 조사기간, 긍정, 부정)\n\nlee_tbl |&gt; select(조사회사, 조사기간, 긍정, 부정)\n\npark_tbl |&gt; pivot_wider(names_from = 긍부정, values_from = 지지율) |&gt; \n  filter(조사회사 == \"한국갤럽\")\n\nmoon_tbl |&gt; pivot_wider(names_from = 긍부정, values_from = 지지율) |&gt; \n  filter(조사회사 == \"한국갤럽\")\n\n\n\n\n대통령 지지율\n이명박/윤석열\n\n\n\n\n코드library(patchwork)\n\nall_approval_gg &lt;- (rho_approval_gg + lee_approval_gg + park_approval_gg)  /\n(moon_approval_gg + yoon_approval_gg)\n\nragg::agg_jpeg(\"images/대통령지지율/전체대통령.jpeg\",\n              width = 10, height = 7, units = \"in\", res = 600)\nall_approval_gg\ndev.off()\n\n\n\n\n\n\n\n\n\n코드two_approval_gg &lt;- (lee_approval_gg)  / (yoon_approval_gg)\n\nragg::agg_jpeg(\"images/대통령지지율/두대통령.jpeg\",\n              width = 10, height = 7, units = \"in\", res = 600)\ntwo_approval_gg\ndev.off()"
  },
  {
    "objectID": "approval_rate.html#결합",
    "href": "approval_rate.html#결합",
    "title": "지도제작 대회",
    "section": "",
    "text": "코드rho_tbl |&gt; select(조사회사, 조사기간, 긍정, 부정)\n\nlee_tbl |&gt; select(조사회사, 조사기간, 긍정, 부정)\n\npark_tbl |&gt; pivot_wider(names_from = 긍부정, values_from = 지지율) |&gt; \n  filter(조사회사 == \"한국갤럽\")\n\nmoon_tbl |&gt; pivot_wider(names_from = 긍부정, values_from = 지지율) |&gt; \n  filter(조사회사 == \"한국갤럽\")\n\n\n\n\n대통령 지지율\n이명박/윤석열\n\n\n\n\n코드library(patchwork)\n\nall_approval_gg &lt;- (rho_approval_gg + lee_approval_gg + park_approval_gg)  /\n(moon_approval_gg + yoon_approval_gg)\n\nragg::agg_jpeg(\"images/대통령지지율/전체대통령.jpeg\",\n              width = 10, height = 7, units = \"in\", res = 600)\nall_approval_gg\ndev.off()\n\n\n\n\n\n\n\n\n\n코드two_approval_gg &lt;- (lee_approval_gg)  / (yoon_approval_gg)\n\nragg::agg_jpeg(\"images/대통령지지율/두대통령.jpeg\",\n              width = 10, height = 7, units = \"in\", res = 600)\ntwo_approval_gg\ndev.off()"
  },
  {
    "objectID": "approval_rate.html#년-기준",
    "href": "approval_rate.html#년-기준",
    "title": "지도제작 대회",
    "section": "\n2.1 1년 기준",
    "text": "2.1 1년 기준\n\n코드\nrm_url &lt;- glue::glue('https://namu.wiki/w/%ED%8B%80:%EB%A6%AC%EC%96%BC%EB%AF%B8%ED%84%B0%20{2006}%EB%85%84%20%EC%A0%95%EB%8B%B9%EC%A7%80%EC%A7%80%EC%9C%A8')\n\nrm_html &lt;- read_html(rm_url)\n\nrm_list &lt;- rm_html |&gt; \n  html_nodes('table') |&gt; \n  html_table(header = TRUE)\n\nrm_raw &lt;- rm_list |&gt; \n  enframe() |&gt; \n  mutate(nrow = map_int(value, nrow)) |&gt; \n  filter(name == 1) |&gt; \n  mutate(조사회사 = \"리얼미터\") \n\nremove_last &lt;- function(vector) {\n  if(vector[length(vector)] ==\"\") {\n    vector[1:(length(vector)-1)]\n  } else {\n    vector\n  }\n}\n\nmake_dataframe &lt;- function(x_vec, y_vec) {\n  data.frame(x_vec, y_vec)\n}\n\n## 정당명과 지지율\nrm_tbl &lt;- rm_raw |&gt; \n  mutate(data = map(value, janitor::clean_names, ascii = FALSE)) |&gt; \n  select(조사회사, data) |&gt; \n  unnest(data) |&gt;\n  select(contains(\"정당지지율\"), x_2) |&gt; \n  set_names(c(\"조사기간\", \"지지율\")) |&gt; \n  mutate(정당명 = ifelse(str_detect(조사기간, \"●\"), \n                      str_split(지지율, \"●\"), NA)) |&gt; \n  mutate(정당명 = map_chr(정당명, paste0, collapse=\"\")) |&gt; \n  mutate(정당명 = ifelse(정당명 == \"NA\", NA, 정당명)) |&gt; \n  fill(정당명, .direction = \"down\") |&gt; \n  filter(str_detect(조사기간, \"^\\\\d{1,2}월\")) |&gt; \n  mutate(지지율 = str_squish(지지율),\n         정당명 = str_squish(정당명)) |&gt; \n  mutate(정당명 = str_split(정당명, pattern = \"\\\\s+/\\\\s+\"),\n         지지율 = str_split(지지율, pattern = \"%\"))  |&gt; \n  mutate(지지율수 = map_int(지지율, length),\n         정당수   = map_int(정당명, length)) |&gt; \n  mutate(지지율 = ifelse(지지율수 == 정당수, 지지율,\n                      map(지지율, remove_last))) |&gt; \n  filter(abs(지지율수 - 정당수)  &lt; 2) |&gt; \n  mutate(data = map2(지지율, 정당명, make_dataframe)) |&gt; \n  select(조사기간, data)\n  \nrm_tbl |&gt; \n  unnest(data)"
  },
  {
    "objectID": "approval_rate.html#함수",
    "href": "approval_rate.html#함수",
    "title": "지도제작 대회",
    "section": "\n2.2 함수",
    "text": "2.2 함수\n\n코드\nget_party_data &lt;- function(year = \"2012\") {\n  \n  rm_url &lt;- glue::glue('https://namu.wiki/w/%ED%8B%80:%EB%A6%AC%EC%96%BC%EB%AF%B8%ED%84%B0%20',\n                       '{year}',\n                       '%EB%85%84%20%EC%A0%95%EB%8B%B9%EC%A7%80%EC%A7%80%EC%9C%A8') |&gt; as.character()\n\n  rm_html &lt;- read_html(rm_url)\n  \n  rm_list &lt;- rm_html |&gt; \n    html_nodes('table') |&gt; \n    html_table(header = TRUE)\n  \n  rm_raw &lt;- rm_list |&gt; \n    enframe() |&gt; \n    mutate(nrow = map_int(value, nrow)) |&gt; \n    filter(name == 1) |&gt; \n    mutate(조사회사 = \"리얼미터\") \n  \n  remove_last &lt;- function(vector) {\n    \n    if(length(vector) &lt; 3){\n      vector\n    } else if(vector[length(vector)] ==\"\") {\n      vector[1:(length(vector)-1)]\n    } else {\n      vector\n    }\n  }\n  \n  make_dataframe &lt;- function(x_vec, y_vec) {\n    min_row &lt;- min(length(x_vec), length(y_vec))\n    data.frame(x_vec = x_vec[1:min_row], y_vec = y_vec[1:min_row])\n  }\n  \n  ## 정당명과 지지율\n  rm_tbl &lt;- rm_raw |&gt; \n    mutate(data = map(value, janitor::clean_names, ascii = FALSE)) |&gt; \n    select(조사회사, data) |&gt; \n    unnest(data) |&gt;\n    select(contains(\"정당지지율\"), x_2) |&gt; \n    set_names(c(\"조사기간\", \"지지율\")) |&gt; \n    mutate(정당명 = ifelse(str_detect(조사기간, \"●\"), \n                        str_split(지지율, \"●\"), NA)) |&gt; \n    mutate(정당명 = map_chr(정당명, paste0, collapse=\"\")) |&gt; \n    mutate(정당명 = ifelse(정당명 == \"NA\", NA, 정당명)) |&gt; \n    fill(정당명, .direction = \"down\") |&gt; \n    filter(str_detect(조사기간, \"^\\\\d{1,2}월\")) |&gt; \n    mutate(지지율 = str_squish(지지율),\n           정당명 = str_squish(정당명)) |&gt; \n    mutate(정당명 = str_split(정당명, pattern = \"\\\\s+/\\\\s+\"),\n           지지율 = str_split(지지율, pattern = \"%\"))  |&gt; \n    mutate(지지율수 = map_int(지지율, length),\n           정당수   = map_int(정당명, length)) |&gt; \n    mutate(지지율 = ifelse(지지율수 == 정당수, 지지율, map(지지율, remove_last))) |&gt; \n    filter(abs(지지율수 - 정당수)  &lt; 2) |&gt; \n    mutate(지지율수 = map_int(지지율, length),\n           정당수   = map_int(정당명, length)) |&gt; \n    mutate(지지율 = ifelse(지지율수 != 정당수, NA, 지지율)) |&gt; \n    fill(지지율, .direction = \"up\") |&gt; \n    mutate(data = map2(지지율, 정당명, make_dataframe)) |&gt; \n    select(조사기간, data)\n\n  \n  rm_df &lt;- rm_tbl |&gt; unnest(data) |&gt; mutate(x_vec = parse_number(x_vec)) |&gt; \n    rename(지지율 = x_vec,\n           정당   = y_vec) |&gt; \n    mutate(연도 = year)\n  \n  return(rm_df)\n}\n\nget_party_data(\"2018\")"
  },
  {
    "objectID": "approval_rate.html#결합-1",
    "href": "approval_rate.html#결합-1",
    "title": "지도제작 대회",
    "section": "\n2.3 결합",
    "text": "2.3 결합\n\n코드\nsafely_get_party_data &lt;- safely(get_party_data, otherwise = \"오류\")\n\nyear &lt;- 2006:2023\n\nparty_raw &lt;- year |&gt; \n  enframe()  |&gt; \n  mutate(data = map(value, safely_get_party_data))\n\nparty_tbl &lt;- party_raw |&gt; \n  mutate(result = map(data, \"result\")) |&gt; \n  mutate(check = map_dbl(result, is_tibble)) |&gt; \n  unnest(result) |&gt; \n  select(연도, 조사기간, 정당, 지지율)\n\nparty_tbl |&gt; \n  write_csv(\"data/리얼미터_정당지지율.csv\")"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "지도제작 대회",
    "section": "",
    "text": "1 참고 웹사이트\n\n#30DayMapChallenge 🌎🌏🌎\n30 DAY MAP CHALLENGE IN R\nAbdoulMa/30DayMapChallenge\n\n2 원천 지도\n\n\n국토교통부\n\n\nLX 한국국토정보공사, 구 한국지적공사\n\n공간정보산업진흥원\n\nVWorld, 공간정보오픈플랫폼\n\n\n\n국토지리정보원\n\n국토정보플랫폼\n\n국가공간정보포털\n\n오픈마켓, 90m 표고 데이터: [국토지리정보원] 수치표고모델(DEM)_90M\n\n\n\n\n\n\n대한민국 행정동 경계: admdongkor\n대한민국 최신 행정구역(SHP) 다운로드\n\n3 세계지도\n출처: Fixing maps library data for Pacific centred (0°-360° longitude) display\n\n\n세계지도: giscoR\n세계지도: maps\n세계지도: rnaturalearth\n아시아\n대한민국\n태평양 중심\n\n\n\n\n코드library(tidyverse)\nlibrary(sf)\n\n# download.file(url = \"https://gisco-services.ec.europa.eu/distribution/v2/countries/geojson/CNTR_RG_01M_2016_4326.geojson\", destfile = \"data/world.geojson\", mode = \"w\")\n# \n# world_sf &lt;- giscoR::gisco_get_countries(\n#   epsg = \"4326\",\n#   region = \"Asia\",\n#   resolution = \"1\",\n#   cache = TRUE, \n#   update_cache = TRUE\n# )\n\nworld_sf &lt;- sf::st_read(\"data/world.geojson\")\n#&gt; Reading layer `world' from data source `D:\\tcs\\map_challenge\\data\\world.geojson' using driver `GeoJSON'\n#&gt; Simple feature collection with 257 features and 6 fields\n#&gt; Geometry type: MULTIPOLYGON\n#&gt; Dimension:     XY\n#&gt; Bounding box:  xmin: -180 ymin: -89.9 xmax: 180 ymax: 83.66498\n#&gt; Geodetic CRS:  WGS 84\n\nplot(st_geometry(world_sf))\n\n\n\n\n\n\n\n\n\n\n코드# 필요한 라이브러리를 불러옵니다.\nlibrary(ggplot2)\nlibrary(maps)\n\n# 월드맵 데이터를 불러옵니다.\nworld_map &lt;- map_data(\"world\")\n\n# ggplot2를 사용해 지도를 그립니다.\nggplot() +\n  geom_polygon(data = world_map, aes(x = long, y = lat, group = group), fill = \"white\", color = \"black\") +\n  coord_cartesian(xlim = c(-180, 180)) +\n  theme_void()\n\n\n\n\n\n\n\n\n\n\n코드library(rnaturalearth)\n\n# Get the world map data\nworld &lt;- ne_countries(scale = \"medium\", returnclass = \"sf\")\n\n# Shift the map to center on the Pacific Ocean\nworld_trans &lt;- st_transform(st_wrap_dateline(world, options = c(\"WRAPDATELINE=YES\", \"DATELINEOFFSET=-180\")), crs = \"+proj=robin\")\n\n# Plot the world map\nggplot(data = world_trans) +\n  geom_sf() +\n  theme_minimal()\n\n\n\n\n\n\n\n\n\n\n코드asia_sf &lt;- giscoR::gisco_get_countries(\n  epsg = \"4326\",\n  region = \"Asia\",\n  resolution = \"60\",\n  cache = TRUE,\n  update_cache = TRUE\n)\n\nplot(st_geometry(asia_sf))\n\n\n\n\n\n\n\n\n\n\n코드library(tidyverse)\nlibrary(sf)\nlibrary(giscoR)\n\nkorea &lt;- giscoR::gisco_get_countries(\n    resolution = \"1\",\n    country = \"KOR\"\n) |&gt;\n    sf::st_transform(\"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0\")\n\nplot(st_geometry(korea))\n\n\n\n\n\n\n\n\n\n\n코드library(maps)\n\nplot.map&lt;- function(database,center,...){\n    Obj &lt;- map(database,...,plot=F)\n    coord &lt;- cbind(Obj[[1]],Obj[[2]])\n\n    # split up the coordinates\n    id &lt;- rle(!is.na(coord[,1]))\n    id &lt;- matrix(c(1,cumsum(id$lengths)),ncol=2,byrow=T)\n    polygons &lt;- apply(id,1,function(i){coord[i[1]:i[2],]})\n\n    # split up polygons that differ too much\n    polygons &lt;- lapply(polygons,function(x){\n        x[,1] &lt;- x[,1] + center\n        x[,1] &lt;- ifelse(x[,1]&gt;180,x[,1]-360,x[,1])\n        if(sum(diff(x[,1])&gt;300,na.rm=T) &gt;0){\n          id &lt;- x[,1] &lt; 0\n          x &lt;- rbind(x[id,],c(NA,NA),x[!id,])\n       }\n       x\n    })\n    # reconstruct the object\n    polygons &lt;- do.call(rbind,polygons)\n    Obj[[1]] &lt;- polygons[,1]\n    Obj[[2]] &lt;- polygons[,2]\n\n    map(Obj,...)\n}\n\nplot.map(\"world\", center=210, col=\"white\",bg=\"gray\",\n         fill=TRUE, ylim=c(-60,90),mar=c(0,0,0,0))"
  },
  {
    "objectID": "km_BitGPT.html",
    "href": "km_BitGPT.html",
    "title": "지도제작 대회",
    "section": "",
    "text": "1 데이터셋\n\n코드library(tidyverse)\n\npop_tbl &lt;- \n  read_rds(\"data/kwangmyung_pop.rds\")\n\npop_tbl |&gt; \n  head() |&gt; \n  gt::gt()\n\n\n\n\n\n시점\n      행정동\n      성별\n      나이\n      인구수\n    \n\n\n2023-07-15\n광명1동\n남자\n0\n0\n\n\n2023-07-15\n광명1동\n남자\n1\n0\n\n\n2023-07-15\n광명1동\n남자\n2\n0\n\n\n2023-07-15\n광명1동\n남자\n3\n0\n\n\n2023-07-15\n광명1동\n남자\n4\n0\n\n\n2023-07-15\n광명1동\n남자\n5\n0\n\n\n\n\n\n\n\n2 챗GPT\n\n코드library(openai)\n\ncreate_chat_completion(\n    model = \"gpt-3.5-turbo\",\n    messages = list(\n        list(\n            \"role\" = \"system\",\n            \"content\" = \"You are a helpful assistant.\"\n        ),\n        list(\n            \"role\" = \"user\",\n            \"content\" = \"Who won the world series in 2020?\"\n        ),\n        list(\n            \"role\" = \"assistant\",\n            \"content\" = \"The Los Angeles Dodgers won the World Series in 2020.\"\n        ),\n        list(\n            \"role\" = \"user\",\n            \"content\" = \"Where was it played?\"\n        )\n    )\n)\n#&gt; $id\n#&gt; [1] \"chatcmpl-7kujkISwp9RYXMi8g3Tiu5iNBilQr\"\n#&gt; \n#&gt; $object\n#&gt; [1] \"chat.completion\"\n#&gt; \n#&gt; $created\n#&gt; [1] 1691415540\n#&gt; \n#&gt; $model\n#&gt; [1] \"gpt-3.5-turbo-0613\"\n#&gt; \n#&gt; $choices\n#&gt;   index finish_reason message.role\n#&gt; 1     0          stop    assistant\n#&gt;                                                             message.content\n#&gt; 1 The 2020 World Series was played at Globe Life Field in Arlington, Texas.\n#&gt; \n#&gt; $usage\n#&gt; $usage$prompt_tokens\n#&gt; [1] 53\n#&gt; \n#&gt; $usage$completion_tokens\n#&gt; [1] 17\n#&gt; \n#&gt; $usage$total_tokens\n#&gt; [1] 70"
  },
  {
    "objectID": "realmeter_metro.html",
    "href": "realmeter_metro.html",
    "title": "지도제작 대회",
    "section": "",
    "text": "코드library(tidyverse)\nlibrary(rvest)\n\nrm_url &lt;- glue::glue('http://www.realmeter.net/category/pdf/page/1/')\n\nrm_html &lt;- read_html(rm_url)\n\n## PDF 다운로드 링크 ---------------\nrm_links_text &lt;- rm_html |&gt; \n  html_nodes(\"a\") |&gt; \n  html_text()\n\nrm_links &lt;- rm_html |&gt; \n  html_nodes(\"a\") |&gt; \n  html_attr(\"href\")\n\nrm_pdf_raw &lt;- tibble('text' = rm_links_text, 'link' = rm_links)\n\nrm_pdf_tbl &lt;- rm_pdf_raw |&gt; \n  filter(str_detect(text, \"주간통계표\")) |&gt; \n  mutate(text = str_extract(text, \"\\\\d{2}년\\\\s+\\\\d{1,2}월\\\\s+\\\\d{1}주\"))  |&gt; \n  mutate(filename = str_extract(link, '[^/]+\\\\.pdf'))\n\n\n\n\n코드fs::dir_create(\"data/realmeter/\")\n\ndownload.file(url = rm_pdf_tbl$link[1], mode='wb', \n              destfile = glue::glue(\"data/realmeter/{rm_pdf_tbl$filename[1]}\"))\n\n\n\n\n코드link &lt;- rm_pdf_tbl$link[2]\nfilename &lt;- rm_pdf_tbl$filename[2]\n\ndownload_pdfs &lt;- function(link, filename) {\n  download.file(url = link, mode='wb', \n              destfile = glue::glue(\"data/realmeter/{filename}\"))\n}\n\ndownload_pdfs(link, filename)\n\n\n\n\n코드\nget_reports &lt;- function(page=\"1\"){\n  \n  rm_url &lt;- glue::glue('http://www.realmeter.net/category/pdf/page/{page}/')\n\n  rm_html &lt;- read_html(rm_url)\n  \n  ## PDF 다운로드 링크 ---------------\n  rm_links_text &lt;- rm_html |&gt; \n    html_nodes(\"a\") |&gt; \n    html_text()\n  \n  rm_links &lt;- rm_html |&gt; \n    html_nodes(\"a\") |&gt; \n    html_attr(\"href\")\n  \n  rm_pdf_raw &lt;- tibble('text' = rm_links_text, 'link' = rm_links)\n  \n  rm_pdf_tbl &lt;- rm_pdf_raw |&gt; \n    filter(str_detect(text, \"주간통계표\")) |&gt; \n    # mutate(text = str_extract(text, \"\\\\d{2}년\\\\s+\\\\d{1,2}월\\\\s+\\\\d{1}주\"))  |&gt; \n    mutate(filename = str_extract(link, '[^/]+\\\\.pdf')) |&gt; \n    mutate(link = ifelse(str_detect(link, \"^http\"), link, \n                         glue::glue(\"http://realmeter.cafe24.com{link}\")))\n  \n  return(rm_pdf_tbl)\n}\n\nget_reports(157)\n\npdf_pages &lt;- 1:157\n\npdf_report_raw &lt;- pdf_pages |&gt; \n  enframe(value = \"page\")  |&gt; \n  slice(156) |&gt; \n  mutate(data = map(page, get_reports)) \n\npdf_report_raw |&gt; \n  unnest(data) |&gt; \n  pull(link)\n\npdf_report_raw |&gt; \n  unnest(data) |&gt; \n  mutate(report = walk2(link, filename, download_pdfs))"
  },
  {
    "objectID": "realmeter_metro.html#pdf-다운로드-링크",
    "href": "realmeter_metro.html#pdf-다운로드-링크",
    "title": "지도제작 대회",
    "section": "",
    "text": "코드library(tidyverse)\nlibrary(rvest)\n\nrm_url &lt;- glue::glue('http://www.realmeter.net/category/pdf/page/1/')\n\nrm_html &lt;- read_html(rm_url)\n\n## PDF 다운로드 링크 ---------------\nrm_links_text &lt;- rm_html |&gt; \n  html_nodes(\"a\") |&gt; \n  html_text()\n\nrm_links &lt;- rm_html |&gt; \n  html_nodes(\"a\") |&gt; \n  html_attr(\"href\")\n\nrm_pdf_raw &lt;- tibble('text' = rm_links_text, 'link' = rm_links)\n\nrm_pdf_tbl &lt;- rm_pdf_raw |&gt; \n  filter(str_detect(text, \"주간통계표\")) |&gt; \n  mutate(text = str_extract(text, \"\\\\d{2}년\\\\s+\\\\d{1,2}월\\\\s+\\\\d{1}주\"))  |&gt; \n  mutate(filename = str_extract(link, '[^/]+\\\\.pdf'))"
  },
  {
    "objectID": "realmeter_metro.html#pdf-다운로드",
    "href": "realmeter_metro.html#pdf-다운로드",
    "title": "지도제작 대회",
    "section": "",
    "text": "코드fs::dir_create(\"data/realmeter/\")\n\ndownload.file(url = rm_pdf_tbl$link[1], mode='wb', \n              destfile = glue::glue(\"data/realmeter/{rm_pdf_tbl$filename[1]}\"))"
  },
  {
    "objectID": "realmeter_metro.html#pdf-다운로드-함수",
    "href": "realmeter_metro.html#pdf-다운로드-함수",
    "title": "지도제작 대회",
    "section": "",
    "text": "코드link &lt;- rm_pdf_tbl$link[2]\nfilename &lt;- rm_pdf_tbl$filename[2]\n\ndownload_pdfs &lt;- function(link, filename) {\n  download.file(url = link, mode='wb', \n              destfile = glue::glue(\"data/realmeter/{filename}\"))\n}\n\ndownload_pdfs(link, filename)"
  },
  {
    "objectID": "realmeter_metro.html#전체-다운로드",
    "href": "realmeter_metro.html#전체-다운로드",
    "title": "지도제작 대회",
    "section": "",
    "text": "코드\nget_reports &lt;- function(page=\"1\"){\n  \n  rm_url &lt;- glue::glue('http://www.realmeter.net/category/pdf/page/{page}/')\n\n  rm_html &lt;- read_html(rm_url)\n  \n  ## PDF 다운로드 링크 ---------------\n  rm_links_text &lt;- rm_html |&gt; \n    html_nodes(\"a\") |&gt; \n    html_text()\n  \n  rm_links &lt;- rm_html |&gt; \n    html_nodes(\"a\") |&gt; \n    html_attr(\"href\")\n  \n  rm_pdf_raw &lt;- tibble('text' = rm_links_text, 'link' = rm_links)\n  \n  rm_pdf_tbl &lt;- rm_pdf_raw |&gt; \n    filter(str_detect(text, \"주간통계표\")) |&gt; \n    # mutate(text = str_extract(text, \"\\\\d{2}년\\\\s+\\\\d{1,2}월\\\\s+\\\\d{1}주\"))  |&gt; \n    mutate(filename = str_extract(link, '[^/]+\\\\.pdf')) |&gt; \n    mutate(link = ifelse(str_detect(link, \"^http\"), link, \n                         glue::glue(\"http://realmeter.cafe24.com{link}\")))\n  \n  return(rm_pdf_tbl)\n}\n\nget_reports(157)\n\npdf_pages &lt;- 1:157\n\npdf_report_raw &lt;- pdf_pages |&gt; \n  enframe(value = \"page\")  |&gt; \n  slice(156) |&gt; \n  mutate(data = map(page, get_reports)) \n\npdf_report_raw |&gt; \n  unnest(data) |&gt; \n  pull(link)\n\npdf_report_raw |&gt; \n  unnest(data) |&gt; \n  mutate(report = walk2(link, filename, download_pdfs))"
  },
  {
    "objectID": "realmeter_metro.html#다운로드-목록",
    "href": "realmeter_metro.html#다운로드-목록",
    "title": "지도제작 대회",
    "section": "\n2.1 다운로드 목록",
    "text": "2.1 다운로드 목록\n\n코드library(tidyverse)\nlibrary(rvest)\n\n## 함수\nget_reports &lt;- function(page=\"1\"){\n  \n  cat(\"\\n----------------------------\\n\", \n      \"     \", page, \" 페이지\",\n      \"\\n----------------------------\\n\")\n  \n  rm_url &lt;- glue::glue('http://www.realmeter.net/category/pdf/page/{page}/')\n\n  rm_html &lt;- read_html(rm_url)\n  \n  ## PDF 다운로드 링크 ---------------\n  rm_links_text &lt;- rm_html |&gt; \n    html_nodes(\"a\") |&gt; \n    html_text()\n  \n  rm_links &lt;- rm_html |&gt; \n    html_nodes(\"a\") |&gt; \n    html_attr(\"href\")\n  \n  rm_pdf_raw &lt;- tibble('text' = rm_links_text, 'link' = rm_links)\n  \n  rm_pdf_tbl &lt;- rm_pdf_raw |&gt; \n    filter(str_detect(text, \"주간통계표\")) |&gt; \n    # mutate(text = str_extract(text, \"\\\\d{2}년\\\\s+\\\\d{1,2}월\\\\s+\\\\d{1}주\"))  |&gt; \n    mutate(filename = str_extract(link, '[^/]+\\\\.pdf')) |&gt; \n    mutate(link = ifelse(str_detect(link, \"^http\"), link, \n                         glue::glue(\"http://realmeter.cafe24.com{link}\")))\n  \n  return(rm_pdf_tbl)\n}\n\n## 다운로드 페이지\n\npdf_pages &lt;- 1:158\n\npdf_report_raw &lt;- pdf_pages |&gt; \n  enframe(value = \"page\")  |&gt; \n  mutate(data = map(page, get_reports))\n\npdf_report_tbl &lt;- pdf_report_raw |&gt; \n  select(data) |&gt; \n  mutate(nrow = map_int(data, nrow)) |&gt; \n  filter(nrow !=0) |&gt; \n  unnest(data)\n\npdf_report_tbl |&gt; \n  write_rds(\"data/realmeter/pdf_report_tbl.rds\")"
  },
  {
    "objectID": "realmeter_metro.html#pdf-다운로드-1",
    "href": "realmeter_metro.html#pdf-다운로드-1",
    "title": "지도제작 대회",
    "section": "\n2.2 PDF 다운로드",
    "text": "2.2 PDF 다운로드\n\n코드pdf_report_tbl &lt;- \n  read_rds(\"data/realmeter/pdf_report_tbl.rds\")\n\n\ndownload_pdfs &lt;- function(link, filename) {\n  cat(\"\\n----------------------------\\n\", \n      \"     \", filename, \": 파일명\",\n      \"\\n----------------------------\\n\")\n  download.file(url = link, mode='wb', \n              destfile = glue::glue(\"data/realmeter/{filename}\"))\n}\n\npdf_report_tbl |&gt; \n  mutate(pdfs = walk2(link, filename, download_pdfs))"
  }
]