---
title: "지도제작 대회"
subtitle: "민주당은 전국정당(?)"
description: |
  민주당은 전국정당인가?
author:
  - name: 이광춘
    url: https://www.linkedin.com/in/kwangchunlee/
    affiliation: 한국 R 사용자회
    affiliation-url: https://github.com/bit2r
title-block-banner: true
format:
  html:
    theme: flatly
    code-fold: true
    code-overflow: wrap
    toc: true
    toc-depth: 3
    toc-title: 목차
    number-sections: true
    highlight-style: github    
    self-contained: false
    default-image-extension: jpg
filters:
   - lightbox
lightbox: auto
link-citations: true
knitr:
  opts_chunk: 
    eval: true
    message: false
    warning: false
    collapse: true
    comment: "#>" 
    R.options:
      knitr.graphics.auto_pdf: true
editor_options: 
  chunk_output_type: console
---


# 데이터셋

```{r}
library(gt)
library(gtExtras)
library(tidyverse)

# Creating the tibble using tribble
age_raw <- tribble(
  ~`연령대`, ~비율,
  "10대후반", "0.1%",
  "20_24", "1.7%",
  "25_29", "4.2%",
  "30_34", "5.3%",
  "35_39", "6.3%",
  "40_45", "9.8%",
  "45_49", "12.2%",
  "50_54", "15.8%",
  "55_59", "13.8%",
  "60_64", "12.8%",
  "65_69", "8.1%",
  "70+", "10.0%"
)

age_tbl <- age_raw |> 
  mutate(비율 = parse_number(비율)/100) |> 
  mutate(당원수 = 비율 * 2454332)

age_tbl |> 
  gt::gt() |> 
  fmt_percent(columns = 비율, decimals = 1) |> 
  fmt_integer(columns = 당원수) |> 
  cols_align("center") |> 
  ## 표 전체 합계 -------------------------------------
  grand_summary_rows(
    columns = 당원수,
    fns =  list(label = "합계", fn = "sum"),
    fmt = ~ fmt_integer(.),
    side = "top"
  )  |> 
  grand_summary_rows(
    columns = 비율,
    fns =  list(label = "합계", fn = "sum"),
    fmt = ~ fmt_percent(., decimals = 0),
    side = "top"
  ) |> 
  gt_theme_538()
```

## 시도별

```{r}
# tribble을 사용하여 tibble 생성
sido_raw <- tribble(
  ~`권리당원`, ~`당원수`, ~`비중`, ~`선거인수`, ~`비중`,
  "서울", 444775, "18.1%", 8378339, "18.9%",
  "부산", 54950, "2.2%", 2916832, "6.6%",
  "대구", 21011, "0.9%", 2044579, "4.6%",
  "인천", 88387, "3.6%", 2534338, "5.7%",
  "광주", 185858, "7.6%", 1206886, "2.7%",
  "대전", 67016, "2.7%", 1233557, "2.8%",
  "울산", 36175, "1.5%", 941189, "2.1%",
  "세종", 12459, "0.5%", 292259, "0.7%",
  "경기", 500892, "20.4%", 11497206, "26.0%",
  "강원", 61088, "2.5%", 1336080, "3.0%",
  "충북", 67330, "2.7%", 1368779, "3.1%",
  "충남", 121512, "5.0%", 1803096, "4.1%",
  "전북", 326518, "13.3%", 1532133, "3.5%",
  "전남", 304151, "12.4%", 1580098, "3.6%",
  "경북", 22126, "0.9%", 2268707, "5.1%",
  "경남", 77845, "3.2%", 2804287, "6.3%",
  "제주", 60667, "2.5%", 565084, "1.3%"
)

sido_raw |> 
  janitor::clean_names(ascii = FALSE) |> 
  select(시도명 = 권리당원, 당원수, 선거인수) |> 
  pivot_longer(당원수:선거인수, names_to = "구분", values_to = "인구수") |> 
  group_by(구분) |> 
  mutate(비율 = 인구수/sum(인구수)) |> 
  # 시각화
  ggplot(aes(x = fct_reorder(시도명, -비율), y = 비율, color = 구분, group = 구분)) +
    geom_point() +
    geom_line()
  

```


